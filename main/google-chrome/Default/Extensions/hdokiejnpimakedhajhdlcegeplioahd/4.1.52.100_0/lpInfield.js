"use strict";function sendRequest(e){if(null!=e)if(e.cmd&&"popupfillinputget"!=e.cmd&&"popupfilliconnumber"!=e.cmd&&L("IF -> BG : cmd="+e.cmd),g_ischrome)try{chrome_runtime_sendMessage(e,function(){})}catch(e){}else g_issafari?safari.self.tab?safari.self.tab.dispatchMessage(e.cmd,e):safari.extension&&safari.extension.globalPage&&safari.extension.globalPage.contentWindow&&safari.extension.globalPage.contentWindow.message_handler({name:e.cmd,message:e,target:window}):g_isfirefoxsdk?(e.messagetype=e.cmd,send_message(e)):g_iscasper&&"function"==typeof t_sendmsg&&t_sendmsg(e)}var g_reference_url="",InfieldIcons={globe:"images/Globe.png",profile:"images/Profile.png",other:"images/Other.png",mastercard:"images/Mastercard.png",visa:"images/Visa.png",amex:"images/Amex.png",discover:"images/Discover.png"},InfieldCommands=function(){function e(e){csTop.LPInfieldFrame.close(e)}function n(e){bg.InfieldCommands.editSite(e,!0)}function t(n){sendRequest({cmd:"autofillaid",aid:n,from_iframe:!0,no_manualfill_on_saveall:!0,fromiframe:1,source:"notrack"}),g("sitelogin",{copy:0,autologin:0,source:"formv2"}),e("action")}function i(e){bg.InfieldCommands.copyUrl(e,!0)}function o(e){bg.InfieldCommands.copyUserName(e,!0)}function r(e){g("sitelogin",{copy:1,autologin:0,source:"formv2"}),bg.InfieldCommands.copyPassword(e,!0,"formv2")}function a(e,n){bg.InfieldCommands.setGeneratePasswordPrefs({prefstr:e,genpwstr:n})}function s(n){bg.InfieldCommands.editFormFill(n,!0,"formv2"),e("action")}function c(n){bg.InfieldCommands.fillForm(n,!0,"formv2"),e("action")}function l(e,n){bg.copytoclipboard(e),g("copypass",{action:n,source:"formv2"})}function d(e){bg.InfieldCommands.getGeneratePasswordPrefs(e)}function p(n,t){bg.InfieldCommands.fillGeneratedPassword(n,t,!0),e("action")}function u(e,n,t){bg.InfieldCommands.searchVault(e,n,t)}function f(e){bg.InfieldCommands.getPopupFillData(e)}function g(e,n){bg.sendLpImprove(e,n)}return{closePopup:e,copyToClipboard:l,editSite:n,fillUsernamePass:t,copyUrl:i,copyUserName:o,copyPassword:r,editFormFill:s,fillForm:c,getGeneratePrefs:d,writeAllPrefs:a,fillGeneratedPassword:p,searchVault:u,getInitialData:f,sendLpImprove:g}}();!function(e){var n=function(n,t,i){var o=this;o._onResizeCallback=i,n&&(n instanceof jQuery?o._triggerElement=n:o._triggerElement=e("#"+n),t?(o._triggerElement.click(function(e){o.show(),o._setPosition(e)}),o._triggerElement.keypress(function(n){o.show(),e(o._menuElement[0]).children().children()[0].focus(),o._setPosition(n)})):(o._triggerElement.children().click(function(e){o.show()}),o._triggerElement.children().keypress(function(n){o.show(),e(o._menuElement[0]).children().children()[0].focus()})))};n.prototype._setPosition=function(n){var t=e(n.currentTarget).offset();t.top+=20,t.left+=20,this._menuElement.offset(t)},n.prototype.show=function(){e(".dropdown").hide(),e(".menuTriggered").removeClass("menuTriggered");var n=this;n._triggerElement.closest(".tile").addClass("menuTriggered"),n._triggerElement.addClass("menuTriggered"),this._menuElement&&this._menuElement.show(0,function(){n._onResizeCallback&&n._onResizeCallback(n._menuElement.height(),90)})},n.prototype.hide=function(e){var n=this;n._triggerElement.closest(".tile").removeClass("menuTriggered"),n._triggerElement.removeClass("menuTriggered"),n._triggerElement.blur(),this._menuElement&&(this._menuElement.hide(e),n._onResizeCallback())},n.prototype.resetTimer=function(e){var n=this;n._menuElement&&(n._menuTimer=setTimeout(function(){n.hide()},e||1e3))},n.prototype.createMenu=function(n,t,i){var o=this;return o._menuElement=e("<div></div>").attr("id",n+"Menu").addClass("dropdown").addClass(t).hide().hover(function(){o._triggerElement.closest(".tile");clearTimeout(o._menuTimer)},function(){o.resetTimer(300)}).append(o._createMenuItems(i)),o._menuElement},n.prototype._createMenuItems=function(n){var t=this;t._menuItems=n;for(var i=e("<ul></ul>").addClass("menuList"),o=0;o<t._menuItems.length;o++){var r=e("<li></li>").attr("data-viewId",t._menuItems[o].id).attr("tabindex","1").click(function(e){t.hide(),t.select(e.currentTarget.getAttribute("data-viewId"),!0)}).focus(function(){clearTimeout(t._menuTimer)}).keypress(function(e){t.hide(),t.select(e.currentTarget.getAttribute("data-viewId"),!0)}).append(e("<p></p>").text(t._menuItems[o].text));i.append(r)}return i},n.prototype._findMenu=function(n){var t=e.grep(this._menuItems,function(e){return e.id===n});return t&&t.length>0?t[0]:null},n.prototype.select=function(e,n){var t=this._findMenu(e);t&&this._triggerElement&&this._triggerElement.find("p").text(t.selectedText),!0===n&&t&&t.action&&t.action()},window.InfieldMenu=n}(jQuery);var InfieldView=function(e){function n(e){Array.isArray(e)&&e.length>0&&(o=e,i())}function t(n){-1!=o.indexOf(n)&&(i(),e("#"+n).show())}function i(){e.each(o,function(n,t){e("#"+t).hide()})}var o=[];return{init:n,show:t}}(jQuery),InfieldGeneratePassword=function(e){function n(n,i,a){e("#moreOptions, #hideOptions").click(function(){r(),a&&a()}),e("#length").on("input",function(){InfieldSearch.debounce(o(),500)}),e(".pwgen").change(t),e("#generateBtn").click(t),e("#pronounceable").click(function(){e("#pronounceable").prop("checked")?(e("#digits").prop("checked",!1),e("#digits").prop("disabled",!0),e("#special").prop("checked",!1),e("#special").prop("disabled",!0),e("#ambig").prop("checked",!1),e("#upper").prop("checked",!0),e("#lower").prop("checked",!0)):(e("#digits").prop("checked",!0),e("#digits").prop("disabled",!1),e("#special").prop("checked",!0),e("#special").prop("disabled",!1))}),e("#ambig").click(function(){e("#ambig").prop("checked")&&(e("#pronounceable").prop("checked",!1),e("#digits").prop("disabled",!1),e("#special").prop("disabled",!1))}),e("#password").on("copy",function(){bg.LPTabState.setCopiedGeneratedPassword(this.value)}).LP_addGeneratePasswordMeter(),bg.InfieldCommands.canCopy(function(t){t?e("#btnCopy").click(function(){var t=e("#password").val();n.copyToClipboard(t,"generatepassword"),e("#btnCopy").hide(),e("#copied").show(),setTimeout(function(){e("#copied").hide(),e("#btnCopy").show()},1e3),bg.LPTabState.setCopiedGeneratedPassword(t)}):e("#btnCopy").hide()});var s=function(){n.fillGeneratedPassword(e("#password").val(),{pronounceable:e("#pronounceable").prop("checked"),length:e("#password").val().length,expand:e("#moreOptions").is(":hidden"),uppercase:e("#upper").prop("checked"),lowercase:e("#lower").prop("checked"),numeric:e("#digits").prop("checked"),special:e("#special").prop("checked"),avoidAmbiguous:e("#ambig").prop("checked"),source:"formv2",variation:"old",generatedPasswordCount:e("#generatedPasswordCount").val()}),c[Object.keys(c).length]=e("#password").val(),n.writeAllPrefs(JSON.stringify({generate_pronounceable:e("#pronounceable").prop("checked")?1:0,generate_length:e("#length").val(),generate_upper:e("#upper").prop("checked")?1:0,generate_lower:e("#lower").prop("checked")?1:0,generate_digits:e("#digits").prop("checked")?1:0,generate_special:e("#special").prop("checked")?1:0,generate_ambig:e("#ambig").prop("checked")?1:0,generate_mindigits:2,generate_reqevery:0}),LPJSON.stringify(c))};e("#fillPasswordBtn").click(s),e("#generateAndFillBtn").click(s),e("#generateAndFillBtn").keypress(s),e("#advancedView").hide(),e("#generateBtnContainer").hide()}function t(){e("#generatedPasswordCount").val(function(){return parseInt(e("#generatedPasswordCount").val())+1});var n=lpCreatePass(e("#length").val(),e("#upper").prop("checked"),e("#lower").prop("checked"),e("#digits").prop("checked"),e("#special").prop("checked"),2,e("#ambig").prop("checked"),!0,e("#pronounceable").prop("checked"));e("#password").val(n).change()}function i(n){c=LPJSON.parse(n.genpwstr);var t=JSON.parse(n.prefstr);e("#length").val(parseInt(t.generate_length)),o(),e("#upper").prop("checked",!!parseInt(t.generate_upper)),e("#lower").prop("checked",!!parseInt(t.generate_lower)),e("#digits").prop("checked",!!parseInt(t.generate_digits)),e("#special").prop("checked",!!parseInt(t.generate_special)),e("#ambig").prop("checked",!!parseInt(t.generate_ambig)),e("#advancedView").hide(),e("#generateAndFillView").show(),parseInt(t.generate_pronounceable)?e("#pronounceable").click():e("#pronounceable").prop("pronounceable",!1),e("#password").val(lpCreatePass(e("#length").val(),e("#upper").prop("checked"),e("#lower").prop("checked"),e("#digits").prop("checked"),e("#special").prop("checked"),2,e("#ambig").prop("checked"),!0,e("#pronounceable").prop("checked"))).change()}function o(){e("#generatedPasswordLength").text(e("#length").val()),e("#sliderFill").width(e("#length").val()+"%")}function r(){e("#advancedView").toggle(),e("#generateAndFillView").toggle(),e("#generateBtnContainer").toggle(),e("#moreOptions").toggle()}function a(){e("#moreOptions").show(),e("#generateBtnContainer").hide()}function s(){e("#moreOptions").hide(),e("#generateBtnContainer").hide()}var c={};return{init:n,setup:i,show:a,hide:s}}(jQuery),InfieldTiles=function(e,n,t,i){function o(t,o,a,l,d,p){c=d;var u=[];if(e("#menuContainer").empty(),e("#"+t).empty().append(e('<p class="italic"></p>').text(p)),a){var f=e.map(a,function(e,n){return e});f.sort(function(e,n){return e}),e.each(f,function(e,t){var a=!1;e+1===f.length&&(a=!0);var c=s(o,{id:"sites"===o?t.aid:t.ffid,name:"sites"===o?t.name:t.decprofilename,description:"sites"===o?t.unencryptedUsername:1==t.profiletype?t.formattedCCNum:null,icons:r(l,o,t),moreText:"sites"===o?i.translateString("More"):i.translateString("Edit"),moreHandler:"sites"===o?null:function(){n.editFormFill(t.ffid)},clickHandler:"sites"===o?function(){csTop.Topics.publish(Topics.INFIELD_NOTIFICATION_FILLED),n.fillUsernamePass(t.aid)}:function(){n.fillForm(t.ffid)},lastTile:a});c&&u.push(c)}),u.length>0&&e("#"+t).empty().append(u)}return u.length}function r(t,i,o){var r="",a="";if("formfills"===i)if(0==o.profiletype)r=InfieldIcons.profile;else switch(o.ccType){case"VISA":r=InfieldIcons.visa;break;case"AMEX":r=InfieldIcons.amex;break;case"MC":r=InfieldIcons.mastercard;break;case"DISC":r=InfieldIcons.discover;break;default:r=InfieldIcons.other}else a="icon-site",t&&o.aid&&t[o.aid]?r=t[o.aid]:(r=InfieldIcons.globe,n.sendLpImprove("iconnotfound",{domain:o.tld}));return{normalEl:e("<img/>").attr("src",r).addClass("icon-default "+a)}}function a(n){return e("<div></div>").addClass("col-2 no-left-gutter no-right-gutter").append(e("<div></div>").addClass("icon").append(n))}function s(i,o){if(!o)return null;var r=null,s=e("<div></div>").addClass("col-8 text full-height"),l=e("<button></button>").attr("id",o.id+"btn").attr("tabindex","1").text(o.moreText);switch(i){case"formfills":s.append(e("<span></span>").text(o.name)),o.description&&s.removeClass("full-height").append(e("<br/>")).append(e("<span></span>").addClass("small").text(o.description));break;case"sites":s.append(e("<span></span>").addClass("small").text(o.name)),o.description&&s.removeClass("full-height").append(e("<br/>")).append(e("<span></span>").text(o.description)),r=new t(l,!0,c);var d=[{id:"editSite",text:"Edit",action:function(){n.editSite(o.id)}}];bg.InfieldCommands.canCopy(function(t){t&&(d.push({id:"copyPassword",text:"Copy password",action:function(){n.copyPassword(o.id)}}),d.push({id:"copyUsername",text:"Copy username",action:function(){n.copyUserName(o.id)}}),d.push({id:"copyURL",text:"Copy URL",action:function(){n.copyUrl(o.id)}})),e("#menuContainer").append(r.createMenu(o.id+"btn","tileDropdown",d))})}o.moreHandler&&l.click(o.moreHandler);var p=e("<div></div>").addClass("col-2 no-right-gutter no-left-gutter pull-right more").append(l),u=a([o.icons.normalEl]);u.click(o.clickHandler),s.click(o.clickHandler);var f=e("<div></div>").addClass("tile col-12").attr("id",o.id).attr("tabindex","1").append(e("<div></div>").addClass("row").append(u,s,p)).hover(function(){},function(){f.removeClass("triggered")});return o.lastTile&&f.addClass("lastTile"),l.focus(function(){f.addClass("triggered")}).blur(function(){f.removeClass("triggered")}).click(function(){f.addClass("menuTriggered"),f.removeClass("triggered")}),f}var c;return{setup:o}}(jQuery,InfieldCommands,InfieldMenu,Strings),InfieldSearch=function(e){function n(n){if(l=e("#searchContainer"),d=e("#currentTab"),p=e("#searchBtnContainer"),u=e("#inlineSearch"),f=e("#searchCloseBtn"),g=e("#searchBtn"),r(),e("#searchBtn").click(function(){i()}).keypress(function(){i()}),e("#searchCloseBtn").click(function(){o(),n("")}).keypress(function(){o(),n("")}),n){var a=t(function(t){n(e(t.currentTarget).val())},500);u.keyup(a)}}function t(e,n){var t;return function(){var i=this,o=arguments;clearTimeout(t),t=setTimeout(function(){t=null,e.apply(i,o)},n)}}function i(){d.fadeOut(),l.show(),l.animate({width:"360px"},250,function(){f.show(),u.fadeIn().focus()}),g.addClass("searchBtnActive")}function o(){u.val(""),u.hide(),f.fadeOut(),l.show(),l.animate({width:"16px"},250,function(){p.fadeOut(),d.fadeIn()}),g.removeClass("searchBtnActive")}function r(){u.hide(),f.hide(),l.show().css({width:"16px"}),p.hide(),d.show(),g.removeClass("searchBtnActive")}function a(){l.show()}function s(){u.hide(),p.hide(),f.hide(),l.hide()}function c(e){e&&!0===e?a():s()}var l,d,p,u,f,g;return{init:n,debounce:t,showIcon:a,hideIcon:s,display:c}}(jQuery),lpInfield=function(e,n,t,i,o,r,a,s,c){function l(){document.addEventListener("DOMContentLoaded",function(){g(function(){c.translate(document.body),d(),f(),i.init(["sitesView","formFillView","generatePassView"]),u(),r.init(m),a.init(n,b,w),new MutationObserver(function(){w()}).observe(e(".infield-dialog")[0],{subtree:!0,childList:!0}),n.getInitialData(v),e("#currentTabText").focus()})})}function d(){y=new s({$parentEl:e(".infield-dialog")}),p({position:360})}function p(n){y&&n&&n.position&&e.isNumeric(n.position)&&n.position>10&&n.position<370&&y.show("top",n.position)}function u(){b=new t("currentTab",null,w);var n=b.createMenu("navigation",null,[{id:"sitesView",text:c.translateString("Log in"),selectedText:c.translateString("Log in as"),action:function(){I.type="sites",v(I)}},{id:"formFillView",text:c.translateString("Fill form"),selectedText:c.translateString("Fill form with"),action:function(){I.type="formfills",v(I)}},{id:"generatePassView",text:c.translateString("Generate password"),selectedText:c.translateString("Generate password"),action:function(){I.type="generate",v(I)}}]);e("#navigationPlaceholder").append(n)}function f(){e("#btnClose").click(function(){n.closePopup("close")}),e("#btnClose").keypress(function(){n.closePopup("close")})}function g(e){var n=document.createElement("iframe");n.setAttribute("class","backgroundFrame"),n.src="backgroundFrame.html",n.style.display="none",n.addEventListener("load",function(){n.contentWindow.LPPlatform.getBackgroundInterface({mainRequestFramework:!1,interfaceDefinition:Interfaces.InfieldPopupInterface,context:"infieldPopup",callback:function(n){window.bg=n,e&&e()}}),n.contentWindow.Topics.get(n.contentWindow.Topics.REQUEST_FRAMEWORK_INITIALIZED).subscribe(function(e,n){var t=parseInt(e.topFrameID);window.csTop=Interfaces.createInstance(Interfaces.ContentScriptInterface,{direct:!1,context:"infieldPopup",requestFunction:function(e){n.sendRequest({type:"contentScriptRequest",data:e,frameID:t})}}),window.csTop.LPFrame.initializeRequestFramework(LPTools.getURLParams().dialogID)})}),document.body.appendChild(n)}function m(e){n.searchVault(e,I.type,h)}function h(e){var n=I.type;if(e){var t=JSON.parse(e);if(t)switch(n){case"sites":o.setup("sitesView",n,t.sites,t.bigicons,w,C);break;case"formfills":o.setup("formFillView",n,t.formfills,null,w,P)}}}function w(n,t){var i=e(".infield-dialog").outerHeight()+20,o=e(".infield-dialog").outerWidth()+10;n&&e.isNumeric(n)&&(i+=n),t&&e.isNumeric(t)&&(o+=t),csTop.LPInfieldFrame.resizeFrame(i,o)}function v(t){if(!t)return void n.closePopup("close");if(I=t,t.type)switch(t.type){case"sites":if(t.fillData.sites){var s=JSON.parse(t.fillData.sites),c=t.fillData.bigIcons?JSON.parse(t.fillData.bigIcons):null,l=o.setup("sitesView",t.type,s,c,w,k);b.select("sitesView"),i.show("sitesView"),r.display(l>2),a.hide()}break;case"formfills":var d=t.fillData.formFills?JSON.parse(t.fillData.formFills):{},l=o.setup("formFillView",t.type,d,null,w,_);b.select("formFillView"),i.show("formFillView"),r.display(l>2),a.hide();break;case"generate":n.getGeneratePrefs(a.setup),b.select("generatePassView"),i.show("generatePassView"),r.display(!1),a.show()}csTop.LPInfieldFrame.positionFrame(function(e){csTop.Topics.publish(Topics.INFIELD_NOTIFICATION_OPENED,e)}),csTop.LPInfieldFrame.show(),e(".infield-dialog").show()}var b,I,y,k=c.translateString("No sites found for this web address. You can log in to this website to save your credentials"),C=c.translateString("No sites found matching your search."),_=c.translateString("No Form Fills saved. You can add one in your Vault."),P=c.translateString("No Form Fills found matching your search.");return{init:l,setArrowPosition:p}}(jQuery,InfieldCommands,InfieldMenu,InfieldView,InfieldTiles,InfieldSearch,InfieldGeneratePassword,lpArrow,Strings);lpInfield&&lpInfield.init();